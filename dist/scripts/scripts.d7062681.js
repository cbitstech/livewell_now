"use strict";angular.module("livewellApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/foundations",{templateUrl:"views/foundations.html",controller:"FoundationsCtrl"}).when("/checkins",{templateUrl:"views/checkins.html",controller:"CheckinsCtrl"}).when("/daily_review",{templateUrl:"views/daily_review.html",controller:"DailyReviewCtrl"}).when("/wellness",{templateUrl:"views/wellness.html",controller:"WellnessCtrl"}).when("/wellness/:section",{templateUrl:"views/wellness.html",controller:"WellnessCtrl"}).when("/wellness",{templateUrl:"views/wellness.html",controller:"WellnessCtrl"}).when("/instructions",{templateUrl:"views/instructions.html",controller:"InstructionsCtrl"}).when("/daily_review_summary",{templateUrl:"views/daily_review_summary.html",controller:"DailyReviewSummaryCtrl"}).when("/daily_review_conclusion",{templateUrl:"views/daily_review_conclusion.html",controller:"DailyReviewConclusionCtrl"}).when("/medications",{templateUrl:"views/medications.html",controller:"MedicationsCtrl"}).when("/skills",{templateUrl:"views/skills.html",controller:"SkillsCtrl"}).when("/team",{templateUrl:"views/team.html",controller:"TeamCtrl"}).when("/intervention",{templateUrl:"views/intervention.html",controller:"InterventionCtrl"}).when("/exit",{templateUrl:"views/exit.html",controller:"ExitCtrl"}).when("/charts",{templateUrl:"views/charts.html",controller:"ChartsCtrl"}).when("/weekly_check_in",{templateUrl:"views/weekly_check_in.html",controller:"WeeklyCheckInCtrl"}).when("/weekly_check_in/:questionIndex",{templateUrl:"views/weekly_check_in.html",controller:"WeeklyCheckInCtrl"}).when("/daily_check_in",{templateUrl:"views/daily_check_in.html",controller:"DailyCheckInCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).when("/localStorageBackupRestore",{templateUrl:"views/localstoragebackuprestore.html",controller:"LocalstoragebackuprestoreCtrl"}).when("/cms",{templateUrl:"views/cms.html",controller:"CmsCtrl"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("livewellApp").controller("MainCtrl",["$scope","UserDetails",function(a){a.pageTitle="LiveWell",a.mainLinks=[{name:"Foundations",href:"foundations"},{name:"Check Ins",href:"checkins"},{name:"Daily Review",href:"daily_review"},{name:"Wellness Plan",href:"wellness"},{name:"Instructions",href:"instructions"},{name:"Settings",href:"settings"}]}]),angular.module("livewellApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("livewellApp").controller("FoundationsCtrl",["$scope",function(a){a.pageTitle="Foundations",a.mainLinks=[{name:"Overview",href:""},{name:"Basic Facts ",href:""},{name:"Medications",href:""},{name:"Coping Skills",href:""},{name:"Team",href:""},{name:"Awareness",href:""},{name:"Action",href:""}]}]),angular.module("livewellApp").controller("CheckinsCtrl",["$scope","$location",function(a){a.pageTitle="Check Ins"}]),angular.module("livewellApp").controller("DailyReviewCtrl",["$scope",function(a){a.pageTitle="Daily Review",a.medicationPercentage=0,a.sleepPercentage=0,a.routinePercentage=0,a.wellnessPercentage=0,a.reviewResponse='<div class="alert-warning alert">No response exists</div>'}]),angular.module("livewellApp").controller("WellnessCtrl",["$scope","$routeParams",function(a,b){switch(a.pageTitle="Wellness Plan",a.section=b.section||"",a.showResources=function(){a.riskVisible=!1,a.awarenessVisible=!1,a.resourcesVisible=!0},a.showRisk=function(){a.awarenessVisible=!1,a.resourcesVisible=!1,a.riskVisible=!0},a.showAwareness=function(){a.resourcesVisible=!1,a.riskVisible=!1,a.awarenessVisible=!0},a.section){case"resources":a.showResources();break;case"awareness":a.showAwareness();break;case"risk":a.showRisk();break;default:a.resourcesVisible=!1,a.riskVisible=!1,a.awarenessVisible=!1}}]),angular.module("livewellApp").controller("InstructionsCtrl",["$scope","StaticContent",function(a){a.pageTitle="Instructions"}]),angular.module("livewellApp").controller("DailyReviewSummaryCtrl",["$scope",function(a){a.pageTitle="Daily Review"}]),angular.module("livewellApp").controller("DailyReviewConclusionCtrl",["$scope","$sanitize",function(a){a.pageTitle="Daily Review",a.lastNotification="ï¿¼Keep up the good work!<br/>Check out your medication plan in Reduce Risk."}]),angular.module("livewellApp").controller("MedicationsCtrl",["$scope","UserData",function(a,b){a.pageTitle="My Medications",a.medications=b.query("medications")}]),angular.module("livewellApp").controller("SkillsCtrl",["$scope",function(a){a.pageTitle="My Skills"}]),angular.module("livewellApp").controller("TeamCtrl",["$scope","UserData",function(a,b){a.pageTitle="My Team",a.team=b.query("team")}]),angular.module("livewellApp").controller("InterventionCtrl",["$scope","Questions",function(a,b){a.pageTitle="Intervention",a.questionGroups=b.query("cyoa"),a.hideProgressBar=!0,console.log(a.questionGroups)}]),angular.module("livewellApp").controller("ExitCtrl",["$scope",function(){navigator.app.exitApp()}]),angular.module("livewellApp").controller("ChartsCtrl",["$scope",function(a){a.pageTitle="My Charts"}]),angular.module("livewellApp").controller("ResourcesCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("livewellApp").controller("RisksCtrl",["$scope",function(a){a.smarts=[{name:"Sleep",value:""},{name:"Medicine",value:"something"},{name:"Abstinence",value:""},{name:"Routine",value:""},{name:"Tranquil",value:""},{name:"Social",value:""}]}]),angular.module("livewellApp").controller("AwarenessCtrl",["$scope","UserData",function(a,b){a.awareness=b.query("awareness")}]),angular.module("livewellApp").controller("WeeklyCheckInCtrl",["$scope","$location","$routeParams","Questions","Guid","UserDetails",function(a,b,c,d,e,f){a.pageTitle="Weekly Check In";var g=d.query("phq9"),h=d.query("amrs");a.questionGroups=[g,h],a.questionIndex=parseInt(c.questionIndex)-1||0,a.submit=function(){var c=$("form").serializeArray(),d=e.create();_.each(c,function(b){var c={userId:f.find,survey:a.pageTitle,questionDataLabel:b.name,questionValue:b.value,sessionGUID:d,savedAt:new Date};console.log(c)}),alert("Thank you, your results have been saved"),b.path("/")}}]),angular.module("livewellApp").controller("DailyCheckInCtrl",["$scope","$location",function(a,b){a.pageTitle="Daily Check In",a.responses=[{order:1,response:"-4",label:"-4",tailoredMessage:"some message"},{order:2,response:"-3",label:"-3",tailoredMessage:"some message"},{order:3,response:"-2",label:"-2",tailoredMessage:"some message"},{order:4,response:"-1",label:"-1",tailoredMessage:"some message"},{order:5,response:"0",label:"0",tailoredMessage:"some message"},{order:6,response:"1",label:"+1",tailoredMessage:"some message"},{order:7,response:"2",label:"+2",tailoredMessage:"some message"},{order:8,response:"3",label:"+3",tailoredMessage:"some message"},{order:9,response:"4",label:"+4",tailoredMessage:"some message"}],a.saveCheckIn=function(){b.path("/daily_review")}}]),angular.module("livewellApp").service("StaticContent",function(){var a={},b="staticContent",c='<div class="alert alert-warning">No content has been provided for this section.</div>';return a.items=void 0!=localStorage[b]?JSON.parse(localStorage[b]):[],a.query=function(b){var d=_.where(a.items,{sectionKey:b});return d.length>0?d[0].content:c},a}),angular.module("livewellApp").controller("FetchContentCtrl",["$scope","$http",function(a,b){var c="https://livewellnew.firebaseio.com/",d="appcollections",e="test",f=".json",g=function(a){_.each(a,function(a){b.get(c+a.route+f+"?userId="+e).success(function(b){localStorage[a.route]=JSON.stringify(_.compact(b)),$("#update-summary").append("<div class='alert alert-sm alert-success'>Updating "+a.label+" successful!</div>")}).error(function(){$("#update-summary").append("<div class='alert alert-sm alert-danger'>Unable to update "+a.label)})})};a.fetchContent=function(){$("#update-summary").html("<br/><br/>"),b.get(c+d+f).success(function(a){g(_.compact(a))}).error(function(){$("#update-summary").append("<div class='alert alert-sm alert-danger'>Unable to access content server, please make sure that you hav access to internet connection.<br/>If you continue to have difficulties please contact the study coordination staff.</div>")})}}]),angular.module("livewellApp").service("UserData",function(){var a={};return a.query=function(b){return console.log(b),a.items=void 0!=localStorage[b]?JSON.parse(localStorage[b]):[],console.log(a.items),a.items},a}),angular.module("livewellApp").service("Questions",["$http",function(a){var b="https://livewellnew.firebaseio.com",c={},d="questions",e="questionresponses",f="questioncriteria",g="responsecriteria";return c.query=function(a){if(void 0!=localStorage[d]){c.items=JSON.parse(localStorage[d]),void 0!=a&&(c.items=_.where(c.items,{questionGroup:a}));var b=JSON.parse(localStorage[e]),h=JSON.parse(localStorage[f]),i=JSON.parse(localStorage[g]);_.each(c.items,function(a,d){c.items[d].responses=_.where(b,{responseGroupId:a.responseGroupId}),c.items[d].criteria=_.where(h,{questionCriteriaId:a.questionCriteriaId}),_.each(c.items[d].responses,function(a,b){c.items[d].responses[b].criteria=_.where(i,{responseId:a.id})})}),c.responses=b,c.questions=JSON.parse(localStorage[d]),c.questionCriteria=h,c.responseCriteria=i,c.items=_.sortBy(c.items,"order")}else c.items=[];return c.items},c.save=function(c,d){localStorage[c]=JSON.stringify(d),a.put(b+"/"+c).success(alert("Data saved to server"))},c.uniqueQuestionGroups=function(){var a=[];return _.each(_.uniq(c.query(),"questionGroup"),function(b){a.push({name:b.questionGroup,id:b.questionGroup})}),_.uniq(a,"name")},c}]),angular.module("livewellApp").directive("questionGroup",["$location",function(a){return{templateUrl:"views/questionGroups/question_group.html",restrict:"E",link:function(b){b._LABELS=b.labels||[{name:"back",label:"&lt;"},{name:"next",label:"&gt;"},{name:"submit",label:"Save"}],b._SURVEY_FAILURE_LABEL=b.surveyFailureLabel||"<b>Unfortunately, this survey failed to load:</b>",b.questionGroups=_.flatten(b.questionGroups),b.surveyFailure=function(){var a={};return a=0==b.questionGroups.length&&_.isArray(b.questionGroups)?{error:!0,message:"There are no questions available."}:0==_.isArray(b.questionGroups)?{error:!0,message:"Questions are not properly formatted."}:{error:!1},1==a.error&&console.error(a),a},b.label=function(a){return _.where(b._LABELS,{name:a})[0].label},b.numberOfQuestions=b.questionGroups.length,b.currentIndex=b.questionIndex||0,b.showQuestion=function(a){return a==b.currentIndex},b.next=function(){b.currentIndex++},b.back=function(){b.currentIndex--},b.submit=b.submit||function(){console.log("OVERRIDE THIS IN YOUR CONTROLLER SCOPE: ",$("form").serializeArray()),a.path("#/")},b.questionViewType=function(a){switch(a){case"radio":return"multiple";case"text":return"single";default:return"html"}}}}}]),angular.module("livewellApp").controller("SettingsCtrl",["$scope",function(a){a.pageTitle="Settings",a.checkinPrompt=null,a.reviewPrompt=null,a.checkinPromptSchedule=function(){alert("Daily Check-In set for "+a.checkinPrompt)},a.reviewPromptSchedule=function(){alert("Daily Review set for "+a.reviewPrompt)}}]),angular.module("livewellApp").service("Guid",function(){var a={};return a.S4=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},a.create=function(){return(a.S4()+a.S4()+"-"+a.S4()+"-4"+a.S4().substr(0,3)+"-"+a.S4()+"-"+a.S4()+a.S4()+a.S4()).toLowerCase()},a}),angular.module("livewellApp").controller("LoginCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("livewellApp").service("Pound",function(){var a={};return console.warn("CAUTION: localForage does not exist"),a.add=function(b,c){var d=[];return localStorage[b]?(d=JSON.parse(localStorage[b]),c.id=d.length+1,c.timestamp=new Date,c.created_at=new Date,console.log(c),d.push(c),localStorage[b]=JSON.stringify(d)):(c.id=1,c.timestamp=new Date,c.created_at=new Date,console.log(c),d=[c],localStorage[b]=JSON.stringify(d),a.add("pound",b)),{added:c}},a.save=function(b,c){var d=[];if(localStorage[b]){var e=!1;d=JSON.parse(localStorage[b]),_.each(d,function(a,b){a.id==c.id&&(e=!0,c.timestamp=new Date,d[b]=c)}),0==e&&(c.id=d.length+1,c.timestamp=new Date,c.created_at=new Date,d.push(c))}else c.id=1,c.created_at=new Date,d=[c],a.add("pound",b);return localStorage[b]=JSON.stringify(d),{saved:c}},a.update=function(a,b){var c=JSON.parse(localStorage[a]);return _.each(c,function(a,d){if(a.id==b.id){for(var e in a)a[e]=b[e],b.updated_at=new Date;c[d]=b}}),localStorage[a]=JSON.stringify(c),{updated:b}},a.find=function(a,b){var c=[];return localStorage[a]?(c=JSON.parse(localStorage[a]),b?_.where(c,b)||[]:c||[]):[]},a.list=function(){return a.find("pound")},a.delete=function(a,b){var c,d=[];return d=JSON.parse(localStorage[a]),_.each(d,function(a,e){a.id==b&&(c=d[e],d[e]=!1)}),localStorage[a]=JSON.stringify(_.compact(d)),{deleted:c}},a.nuke=function(b){var c=a.list;return localStorage.removeItem(b),_.each(c,function(a,d){a==b&&(c[d]=!1)}),localStorage.pound=JSON.stringify(_.compact(c)),{cleared:b}},a}),angular.module("livewellApp").service("UserDetails",["Pound",function(a){var b="user",c={};return void 0==localStorage[b],c.find=a.find(b,{uid:"1"})[0],c.update=function(d){return a.update(b,d),c.find},c.updateKey=function(a,b){var d=c.find;return d[a]=b,c.update(d)},c}]),angular.module("livewellApp").controller("LocalstoragebackuprestoreCtrl",["$scope","$sanitize",function($scope,$sanitize){$scope.initiateLocalBackup=function(){$scope.localStorageContents=JSON.stringify(JSON.stringify(localStorage))},$scope.restoreLocalBackup=function(){var restoreContent=JSON.parse(JSON.parse($scope.localStorageContents));_.each(_.keys(restoreContent),function(el){localStorage[el]=eval("restoreContent."+el)}),localStorage=JSON.parse($scope.localStorageContents)},$scope.updateRemoteService=function(){},$scope.wipeLocalStorage=function(){localStorage.clear()}}]),angular.module("livewellApp").controller("CmsCtrl",["$scope","Questions",function(a,b){a.formFieldTypes=["checkbox","radio","html","text","textarea","select","email","time","phone","url"],a.questionGroups=b.uniqueQuestionGroups(),a.questions=b.questions,a.responses=b.responses,a.questionCriteria=b.questionCriteria,a.responseCriteria=b.responseCriteria,console.log(b),a.viewTypes=[{name:"Table",value:"table"},{name:"Map",value:"map"}],a.viewType="table",a.questionGroup="cyoa",a.selectedQuestions=_.sortBy(b.query(a.questionGroup),"questionGroup"),a.showGroup=function(){a.selectedQuestions=_.sortBy(b.query(a.questionGroup),"questionGroup"),console.log(a.selectedQuestions)},a.editResponses=function(b){a.modalTitle="Edit Responses",a.responseGroupId=b,a.showResponses=_.where(a.responses,{responseGroupId:a.responseGroupId}),a.uniqueResponseGroups=_.pluck(_.uniq(a.responses,"responseGroupId"),"responseGroupId"),a.goesToOptions=a.selectedQuestions,$("#responseModal").modal()},a.saveResponses=function(){$("#responseModal").modal("toggle"),b.save("responses",a.responses),b.save("responseCriteria",a.responseCriteria)},a.editQuestion=function(){},a.addQuestion=function(){},a.deleteQuestion=function(){},a.editCriteria=function(){}}]),angular.module("livewellApp").controller("AdminCtrl",["$scope","Questions",function(){}]);